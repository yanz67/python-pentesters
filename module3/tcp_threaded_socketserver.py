#!/usr/bin/env python3

import socketserver
import threading


class ThreadedSocketServerRequestHandler(socketserver.BaseRequestHandler):
    def handle(self) -> None:
        print(f'client connected: {self.client_address}')
        data = str(self.request.recv(1024), 'ascii')
        cur_thread = threading.current_thread()
        print(f'thread: {cur_thread.name}')
        self.request.send(data.encode())


if __name__ == '__main__':
    server = socketserver.ThreadingTCPServer(('0.0.0.0', 9000), ThreadedSocketServerRequestHandler)
    with server:
        ip, port = server.server_address
        server_thread = threading.Thread(target=server.serve_forever())
        server_thread.setDaemon(True)
        server_thread.start()
        print("Server loop running in thread:", server_thread.name)
